{"version":3,"sources":["common/directives/loginComponent/loginComponent.controller.spec.js"],"names":[],"mappings":"AAAA,OAAO,SAAS,CAAC,WAAW,iBAAiB,QAAQ,SAAS,cAAc,gCAAgC,UAAU,SAAS;EAC7H,IADK,SAEA,MACA,OACA,WAEA,0BAGD;EAPJ,OAAO;IACL,SAAS,CAAC,UAAU,UAAU;MAH3B,UAAO,SAAA;OAKP,UAAU,eAAe,IAAI,UAAU,OAAO;MAH9C,OAAI,MAAA;OAKJ,UAAU,QAAQ;MAJlB,QAAK,OAAA;OAML,UAAU,YAAY;MALtB,YAAS,WAAA;OAOT,UAAU,2BAA2B;MALrC,2BAAwB,0BAAA;;IAQ3B,SAAS,YAAY;MACnB;;MAPN,KAAK,IAAI;MACH,SAAS,KAAK;;MAEpB,SAAS,kCAAkC,YAAM;QAC/C,IAAI,aAAU;QACd,IAAI,aAAU;QACd,IAAI,SAAM;QACV,IAAI,WAAQ;QACZ,IAAI,OAAI;;QAER,WAAW,QAAQ,KAAK,OAAO,yBAAyB;;QAExD,WAAW,OAAO,UAAC,aAAa,cAAiB;UAC/C,aAAa;UACb,SAAS;YACP,IAAI,MAAM;;UAEZ,WAAW;UACX,OAAO;YACL,OAAO,MAAM,OAAO,QAAQ,QAAQ;;;UAGtC,aAAa,YAAY,sBAAsB,EAAE,QAAA,QAAQ,UAAA,UAAU,MAAA;;;QAGrE,SAAS,gBAAgB,YAAM;UAC7B,WAAW,YAAM;YACf,WAAW,UAAU,SAAS;YAC9B,WAAW,UAAU,aAAa;YAClC,WAAW,OAAO;cAChB,OAAO;cACP,UAAU;;;;UAId,GAAG,2CAA2C,YAAM;YAClD,WAAW,UAAU,SAAS;YAC9B,WAAW;YACX,OAAO,KAAK,OAAO,IAAI,GAAG,KAAK,KAAK;;;UAGtC,GAAG,yDAAyD,YAAM;YAChE,WAAW,UAAU,aAAa;YAClC,WAAW;YACX,OAAO,KAAK,OAAO,IAAI,GAAG,KAAK,KAAK;;;UAGtC,GAAG,qCAAqC,YAAM;YAC5C,WAAW;YACX,OAAO,KAAK,MAAM,KAAK,GAAG,IAAI,GAAG,KAAK,MAAM;cAC1C,UAAU,WAAW,KAAK;cAC1B,UAAU,WAAW,KAAK;;;;UAI9B,GAAG,+CAA+C,UAAC,MAAS;YAC1D,IAAM,mBAAmB,IAAI,QAAQ;YACrC,KAAK,QAAQ,MAAM,OAAO,QAAQ;;YAElC,WAAW;;YAEX,iBAAiB,KAAK,YAAM;cAC1B,OAAO,OAAO,IAAI,GAAG,KAAK,KAAK,WAAW,WAAW,MAAM,EAAE,QAAQ;cACrE;eACA,SACK;;;UAGT,GAAG,qCAAqC,UAAC,MAAS;YAChD,IAAM,MAAM;cACV,MAAM;cACN,SAAS;;YAEX,IAAM,mBAAmB,IAAI,QAAQ,OAAO;YAC5C,KAAK,QAAQ,MAAM,OAAO,QAAQ;;YAElC,WAAW;;YAEX,iBAAgB,SAAO,YAAM;cAC3B,OAAO,WAAW,OAAO,MAAM,GAAG,KAAK,MAAM;cAC7C;eACA,SACK;;;UAGT,GAAG,wDAAwD,UAAC,MAAS;YACnE,IAAM,MAAM;cACV,MAAM,EAAE,MAAM,KAAK,SAAS;;YAE9B,IAAM,mBAAmB,IAAI,QAAQ,OAAO;YAC5C,KAAK,QAAQ,MAAM,OAAO,QAAQ;;YAElC,WAAW;;YAEX,iBAAgB,SAAO,YAAM;cAC3B,OAAO,WAAW,UAAU,YAAY,GAAG,GAAE;cAC7C;eACA,SACK;;;;;;GAYV","file":"loginComponent.controller.spec.js","sourcesContent":["import angular from 'angular';\nimport 'angular-mocks';\nimport chai from 'chai';\nimport sinon from 'sinon';\nimport sinonChai from 'sinon-chai';\n\nimport loginComponentController from './loginComponent.controller';\n\nchai.use(sinonChai);\nconst expect = chai.expect;\n\ndescribe('controller: LoginComponentCtrl', () => {\n  let $rootScope;\n  let controller;\n  let $state;\n  let $animate;\n  let Auth;\n\n  beforeEach(angular.mock.module(loginComponentController.name));\n\n  beforeEach(inject(($controller, _$rootScope_) => {\n    $rootScope = _$rootScope_;\n    $state = {\n      go: sinon.stub()\n    };\n    $animate = {};\n    Auth = {\n      login: sinon.stub().returns(Promise.resolve())\n    };\n\n    controller = $controller('LoginComponentCtrl', { $state, $animate, Auth });\n  }));\n\n  describe('login method', () => {\n    beforeEach(() => {\n      controller.loginForm.$valid = true;\n      controller.loginForm.$submitted = false;\n      controller.user = {\n        email: 'anEmail',\n        password: 'aPassword'\n      };\n    });\n\n    it('does nothing if loginForm is not $valid', () => {\n      controller.loginForm.$valid = false;\n      controller.login();\n      expect(Auth.login).not.to.have.been.called;\n    });\n\n    it('does nothing if loginForm has already been $submitted', () => {\n      controller.loginForm.$submitted = true;\n      controller.login();\n      expect(Auth.login).not.to.have.been.called;\n    });\n\n    it('creates the user for a valid form', () => {\n      controller.login();\n      expect(Auth.login.args[0][0]).to.deep.equal({\n        username: controller.user.email,\n        password: controller.user.password\n      });\n    });\n\n    it('goes to the content state after saving user', (done) => {\n      const loginUserPromise = new Promise.resolve();\n      Auth.login = sinon.stub().returns(loginUserPromise);\n\n      controller.login();\n\n      loginUserPromise.then(() => {\n        expect($state.go).to.have.been.calledWith('content', null, { reload: true });\n        done();\n      })\n      .catch(done);\n    });\n\n    it('catches errors when saving a user', (done) => {\n      const err = {\n        code: 401,\n        message: 'Not Authorized'\n      };\n      const loginUserPromise = new Promise.reject(err);\n      Auth.login = sinon.stub().returns(loginUserPromise);\n\n      controller.login();\n\n      loginUserPromise.catch(() => {\n        expect(controller.errors[401]).to.deep.equal(err);\n        done();\n      })\n      .catch(done);\n    });\n\n    it('allows the form to be submitted again after an error', (done) => {\n      const err = {\n        data: { code: 401, message: 'Not Authorized' }\n      };\n      const loginUserPromise = new Promise.reject(err);\n      Auth.login = sinon.stub().returns(loginUserPromise);\n\n      controller.login();\n\n      loginUserPromise.catch(() => {\n        expect(controller.loginForm.$submitted).to.be.false;\n        done();\n      })\n      .catch(done);\n    });\n  });\n\n});\n"]}