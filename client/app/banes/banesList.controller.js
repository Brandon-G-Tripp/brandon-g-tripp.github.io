"use strict";System.register(["angular","lodash","./banes.json!"],function(_export,_context){function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}function _defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}function _createClass(Constructor,protoProps,staticProps){return protoProps&&_defineProperties(Constructor.prototype,protoProps),staticProps&&_defineProperties(Constructor,staticProps),Constructor}var angular,banes,BanesCtrl;return{setters:[function(_angular){angular=_angular["default"]},function(_lodash){},function(_banesJson){banes=_banesJson["default"]}],execute:function(){BanesCtrl=function(){function BanesCtrl($scope,$location,$mdMedia,Config,Link){var _this=this;_classCallCheck(this,BanesCtrl),this.$scope=$scope,this.$location=$location,this.$scope.$mdMedia=$mdMedia,this.Config=Config,this.Link=Link,this.items=banes||[],this.filterAttributes=_.uniq(_.flatten(_.map(banes,"attackAttributes"))).map(function(attr){return{name:attr}}),this.selectedAttributes=[],this.searchQuery="",this.searchText="",this.powerLevelValue=this.$location.$$search.All||9,_.isEmpty(this.$location.$$search)||(this.selectedAttributes=[],Object.keys(this.$location.$$search).forEach(function(val){_.find(_this.filterAttributes,{name:val})&&_this.selectedAttributes.push({name:val,power:_this.$location.$$search[val]})})),this.$scope.$watch("banesCtrl.powerLevelValue",function(newVal,oldVal){_this.$location.$$search.All&&_this.$location.search("All",newVal)},!0),this.$scope.$watch("banesCtrl.selectedAttributes",function(newVal,oldVal){_this.$location.$$search={};var newAttrs=newVal.filter(function(attr){return"All"!==attr.name});if(newVal.length>oldVal.length){var addedAttr=_.difference(_.map(newAttrs,"name"),_.map(oldVal,"name")),addedAttrIndex=_.findIndex(newAttrs,{name:addedAttr[0]});addedAttrIndex>-1&&newAttrs.map(function(attr){addedAttr[0]===attr.name&&(attr.power="".concat(_this.powerLevelValue))})}newVal=_.uniqBy(newVal,"name"),_.isEmpty(newVal)?newVal=[{name:"All"}]:newAttrs.length>0&&(newVal=newAttrs),newVal.map(function(attr){return attr.power=attr.power||"".concat(_this.powerLevelValue),attr}),newVal.forEach(function(attr){_this.$location.search(attr.name,attr.power)}),_this.selectedAttributes=newVal},!0)}return _createClass(BanesCtrl,[{key:"updateSearchTextModel",value:function(val){this.searchText=val}},{key:"attackAttrSearchFilter",value:function(){var _this2=this;return Promise.resolve().then(function(){return _this2.filterAttributes.filter(function(attr){var alreadyUsed=_this2.selectedAttributes.filter(function(selected){return selected.name===attr.name});return!(alreadyUsed.length>0)&&(""===_this2.searchText||attr.name.toLowerCase().match(_this2.searchText.toLowerCase()))})})}},{key:"textSearchFilter",value:function(){var _this3=this;return function(thisPower){var item=thisPower;if(""===_this3.searchQuery&&_.includes(_this3.selectedAttributes,"All"))return!0;var regex=new RegExp(_this3.searchQuery,"gi"),show=!1,inAttackFilter=!0;if(show=item.name.match(regex)||item.description.match(regex)||item.effect.match(regex),_this3.selectedAttributes.length>0){var inAttackFilter=!1;if(_.find(_this3.selectedAttributes,{name:"All"}))inAttackFilter=!0;else var searchAttrs=angular.copy(_.without(_this3.selectedAttributes,"All")),inAttackFilter=_.intersection(item.attackAttributes,_.map(searchAttrs,"name")).length>0}return show&&inAttackFilter}}},{key:"powerLevelFilter",value:function(){var _this4=this;return function(thisPower){var item=thisPower,include=!1;if("9"===_this4.$location.$$search.All)return!0;if(_.compact(_.map(_this4.selectedAttributes,"power")).length>0)for(var i=0;i<=item.power.length;i++){var intersectAttributes=_.intersection(item.attackAttributes,_.map(_this4.selectedAttributes,"name"));if(_this4.$location.$$search.All>=item.power[0])return include=!0;if(intersectAttributes.length>0)return intersectAttributes.forEach(function(attr){(_this4.$location.$$search[attr]>=item.power[0]||_this4.$location.$$search[attr]>=item.power[0])&&(include=!0)}),include}return include}}}]),BanesCtrl}(),_export("default",BanesCtrl)}}});